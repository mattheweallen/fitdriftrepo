<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

<h:body>
	<ui:composition template="/template/layout.xhtml">
		<ui:define name="scripts">
			<title>Fitdrift Create Path</title>
			<script type="text/javascript"
				src="https://maps.googleapis.com/maps/api/js?key=AIzaSyApDXRNzq6eGqWKUbufj3MzhJ4P0RF0Ghw&amp;sensor=false">
				
			</script>
		</ui:define>
		<ui:define name="bodyOnLoad">
		<script type="text/javascript">
			function bodyOnLoad() {
					////
					var gmap = PF('map').getMap();
					
					var styles = [
					  {
					    featureType: "poi",
					    stylers: [
					      { visibility: "off" }
					    ]
					  }
					]

	                gmap.setOptions({styles: styles});
					/////
				}
			</script>
		</ui:define>
		
		
		<ui:define name="content">


			<h:form>

				<h:panelGrid styleClass="panelGridCenter">
					<p:panelGrid columns="4" styleClass="panelGridCenter">
						<p:inputText value="#{createPathBean.myMapName}"
							style="width : 400px" size="40"></p:inputText>

						<p:commandButton value="Save" action="#{createPathBean.savePath}" icon="ui-icon-check">
						</p:commandButton>
						<p:commandButton value="Restart" icon="ui-icon-arrowreturn-1-w"
							action="#{createPathBean.restartPath}">
						</p:commandButton>
						<p:commandButton value="Cancel"
							action="mymaps?faces-redirect=true" icon="ui-icon-close">
						</p:commandButton>
					</p:panelGrid>
				</h:panelGrid>

				<p:growl id="messages" showDetail="true" sticky="true"
					autoUpdate="true" />
			</h:form>
			
			<p:gmap id="map_canvas" center="#{createPathBean.center}" zoom="13" 
				type="HYBRID" style="width:100%;height:400px" 
				onPointClick="handlePointClick(event);" widgetVar="map"  />

			<p:dialog widgetVar="dlg" showEffect="fade">
				<h:form prependId="false">
					<h:panelGrid columns="2">
						<p:inputText id="title" value="#{createPathBean.title}"
							placeholder="Title" />
						<f:facet name="footer">
							<h:panelGrid styleClass="panelGridCenter" columns="2">
								<p:commandButton value="Add"
									actionListener="#{createPathBean.addMarker}"
									oncomplete="markerAddComplete()" />
								<p:commandButton value="Cancel" onclick="return cancel()" />
							</h:panelGrid>
						</f:facet>
					</h:panelGrid>

					<h:inputHidden id="lat" value="#{createPathBean.lat}" />
					<h:inputHidden id="lng" value="#{createPathBean.lng}" />
				</h:form>
			</p:dialog>

			<script type="text/javascript">
				var currentMarker = null;
				
				

				function handlePointClick(event) {
					
					
					if (currentMarker === null) {
						document.getElementById('lat').value = event.latLng
								.lat();
						document.getElementById('lng').value = event.latLng
								.lng();

						currentMarker = new google.maps.Marker({
							position : new google.maps.LatLng(event.latLng
									.lat(), event.latLng.lng())
						});

						PF('map').addOverlay(currentMarker);

						PF('dlg').show();
					}
				}

				function markerAddComplete() {
					var title = document.getElementById('title');
					currentMarker.setTitle(title.value);
					title.value = "";

					currentMarker = null;
					PF('dlg').hide();
				}

				function cancel() {
					PF('dlg').hide();
					currentMarker.setMap(null);
					currentMarker = null;

					return false;
				}
			</script>
		</ui:define>
	</ui:composition>
</h:body>
</html>